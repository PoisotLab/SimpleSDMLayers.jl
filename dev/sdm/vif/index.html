<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Variable selection (VIF) · Simple SDM Layers</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Simple SDM Layers logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Simple SDM Layers</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../man/types/">Types</a></li><li><a class="tocitem" href="../../man/indexing/">Indexing</a></li><li><a class="tocitem" href="../../man/clip/">Clipping</a></li><li><a class="tocitem" href="../../man/changevalues/">Operations on values</a></li><li><a class="tocitem" href="../../man/overloads/">Overloads</a></li><li><a class="tocitem" href="../../man/operations/">Other operations</a></li><li><a class="tocitem" href="../../man/data/">Data access</a></li><li><a class="tocitem" href="../../man/io/">IO</a></li></ul></li><li><span class="tocitem">General examples</span><ul><li><a class="tocitem" href="../../examples/elevation/">Introduction: elevation data</a></li><li><a class="tocitem" href="../../examples/geometry/">Geometry for clipping</a></li><li><a class="tocitem" href="../../examples/slidingwindow/">Sliding window analysis</a></li><li><a class="tocitem" href="../../examples/landcover/">Landcover data</a></li><li><a class="tocitem" href="../../examples/multivariate/">Multivariate mapping</a></li></ul></li><li><span class="tocitem">SDM case studies</span><ul><li><a class="tocitem" href="../gbif/">GBIF integration</a></li><li class="is-active"><a class="tocitem" href>Variable selection (VIF)</a></li><li><a class="tocitem" href="../bioclim/">Building the BIOCLIM model</a></li><li><a class="tocitem" href="../pseudoabsences/">Pseudo-absences</a></li><li><a class="tocitem" href="../future/">Dealing with future data</a></li><li><a class="tocitem" href="../brt/">BRTs and climate change</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">SDM case studies</a></li><li class="is-active"><a href>Variable selection (VIF)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Variable selection (VIF)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/EcoJulia/SimpleSDMLayers.jl/docs/src/sdm/vif.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Variable-selection-with-the-VIF"><a class="docs-heading-anchor" href="#Variable-selection-with-the-VIF">Variable selection with the VIF</a><a id="Variable-selection-with-the-VIF-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-selection-with-the-VIF" title="Permalink"></a></h1><pre><code class="language-julia hljs">using SimpleSDMLayers
using GLM
using Statistics</code></pre><p><strong>Justification for this use case:</strong> a lot of predictive variables are auto-correlated, and therefore one might argue that maybe, we may eventually build better models by removing some of them. This is generally refered to as variable selection, and sharing one&#39;s opinion on this is the fastest way to start a brawl at any gathering of ecologists.</p><p>We will illustrate variable selection with the Variance Inflation Factor using the bioclim data from the region in which <em>Hypomyces lactifluorum</em> is found.</p><pre><code class="language-julia hljs">layers = SimpleSDMPredictor(
    WorldClim, BioClim, 1:19; left=-169.0, right=-50.0, bottom=24.0, top=71.0
);</code></pre><p>We will first gather everything in a matrix:</p><pre><code class="language-julia hljs">x = hcat([layer[keys(layer)] for layer in layers]...);
size(x)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(100548, 19)</code></pre><p>Because of the spread of some values, we will center and reduce this matrix to give every variable a mean of 0 and unit variance:</p><pre><code class="language-julia hljs">X = (x .- mean(x; dims=1)) ./ std(x; dims=1)
round.(Int, mean(X; dims=1))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1×19 Matrix{Int64}:
 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0</code></pre><p>The VIF is simply measured as 1/(1-R²) by regressing every variable against all others. Let&#39;s have an illustration with the first predictor:</p><pre><code class="language-julia hljs">function vif(model)
    R² = r2(model)
    return 1 / (1 - R²)
end

vif(lm(X[:, 2:end], X[:, 1]))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">730.2379f0</code></pre><p>The generally agreed threshold for a good VIF is 2, or 5, or 10 (so both &quot;generally&quot; and &quot;agreed&quot; are overstatements here), and as this one is higher, it suggests that we may not need all of these data. It is also entirely possible to have an <em>infinite</em> VIF, in case two variables are perfectly correlated (this happens a fair amount with bioclim, in fact).</p><p>For this reason, we will go through an iterative process to get rid of variables one by one until the largest VIF is no larger than some threshold. Specifically, we get rid of the variable with the largest VIF first. Let&#39;s try this with the full sample:</p><pre><code class="language- hljs">vifs = zeros(Float64, length(layers))
for i in eachindex(layers)
    vifs[i] = vif(lm(X[:, setdiff(eachindex(selection), i)], X[:, i]))
end
findmax(vifs)</code></pre><p>This result suggests that this variable, because it has the highest VIF (and one that is above our threshold), should be dropped. Repeating the process is a good use case for a recursive function:</p><pre><code class="language-julia hljs">function stepwisevif(
    layers::Vector{T}, selection=collect(1:length(layers)), threshold::Float64=5.0
) where {T&lt;:SimpleSDMLayer}
    x = hcat([layer[keys(layer)] for layer in layers[selection]]...)
    X = (x .- mean(x; dims=1)) ./ std(x; dims=1)
    vifs = zeros(Float64, length(selection))
    for i in eachindex(selection)
        vifs[i] = vif(lm(X[:, setdiff(eachindex(selection), i)], X[:, i]))
    end
    all(vifs .&lt;= threshold) &amp;&amp; return selection
    drop = last(findmax(vifs))
    popat!(selection, drop)
    @info &quot;Variables remaining: $(selection)&quot;
    return stepwisevif(layers, selection, threshold)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">stepwisevif (generic function with 3 methods)</code></pre><p>This function will operate on a collection of layers, and starting from a selection (of indices), iterate until a subset satisfying max(VIF) &lt; threshold is found. We can run this function on our entire dataset:</p><pre><code class="language-julia hljs">selected_variables_id = stepwisevif(layers)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6-element Vector{Int64}:
  2
  7
  8
 15
 18
 19</code></pre><p>Which variables are these?</p><pre><code class="language-julia hljs">layernames(WorldClim, BioClim)[selected_variables_id]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(&quot;Mean Diurnal Range&quot;, &quot;Temperature Annual Range&quot;, &quot;Mean Temperature of Wettest Quarter&quot;, &quot;Precipitation Seasonality&quot;, &quot;Precipitation of Warmest Quarter&quot;, &quot;Precipitation of Coldest Quarter&quot;)</code></pre><p>Finally, we can select the variables this process recommends:</p><pre><code class="language-julia hljs">layers[selected_variables_id]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6-element Vector{SimpleSDMPredictor{Float32}}:
 SDM predictor → 282×714 grid with 100548 Float32-valued cells
 SDM predictor → 282×714 grid with 100548 Float32-valued cells
 SDM predictor → 282×714 grid with 100548 Float32-valued cells
 SDM predictor → 282×714 grid with 100548 Float32-valued cells
 SDM predictor → 282×714 grid with 100548 Float32-valued cells
 SDM predictor → 282×714 grid with 100548 Float32-valued cells</code></pre><p>Before we move on – variable selection, especially stepwise, is not necessarilly a <em>good</em> practice. Alternatives are model selection, dimensionality reduction using <em>e.g.</em> PCA, or other methods to remove the problematic covariance structure in the data. In Julia, a lot of this can be done using the <code>MultivariateStats</code> package. This can be an interesting exercise: rather than relying on VIF, what would the dimensionsality of the results look like with a PCA cutoff at 99% of explained variance?</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gbif/">« GBIF integration</a><a class="docs-footer-nextpage" href="../bioclim/">Building the BIOCLIM model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Wednesday 7 September 2022 16:41">Wednesday 7 September 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
